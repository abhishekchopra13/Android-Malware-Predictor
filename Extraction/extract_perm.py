import xml.etree.ElementTree as ET
import pandas as pd
import os
def remove(string): 
    return "".join(string.split()) 
#Default Permissions
print("Reading Default Permissions\n")
f = open("new_perm.txt","r")
DefaultPerm = f.readlines()
print("Default permissions read\n")
#The following list l has permissions used by the app
l = list(DefaultPerm)
# This extracts permissions in xml file
print("Extracting features from test.apk file\n")
os.system("androguard axml -o test.xml test.apk")
root = ET.parse("test.xml").getroot()
permissions = root.findall("uses-permission")
# for x in list(l):
#     print(x)

# Initialising the dictionary d
d = {}
for x in set(l):
    d[x] = 0
for perm in permissions:
    for att in perm.attrib:
        to_str = str(perm.attrib[att])
        for it in l:
            if remove(it) == remove(to_str):
                d[it] = 1
        #print("{}\n".format(perm.attrib[att])) #Marking the permission found to be 1
# # for x in d:
# #     if d[x] == -1:
# #         d[x] = 0
df = pd.DataFrame([d])
df.to_csv('Permcsvfile.csv', index=False,header = True)
print("Features Extracted data has been saved to Permcsvfile.csv\n")
